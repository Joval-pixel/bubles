<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bubles â€“ A Bolsa que Respira</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    class Bubble {
      constructor(x, y, radius, color, text, vx, vy) {
        this.x = x;
        this.y = y;
        this.radius = radius;
        this.color = color;
        this.text = text;
        this.vx = vx;
        this.vy = vy;
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.shadowColor = this.color;
        ctx.shadowBlur = 15;
        ctx.fill();
        ctx.closePath();
        ctx.shadowBlur = 0;

        ctx.fillStyle = "white";
        ctx.font = `${Math.max(this.radius / 3, 10)}px Arial`;
        ctx.textAlign = "center";
        ctx.fillText(this.text, this.x, this.y + 4);
      }

      update(bubbles) {
        this.x += this.vx;
        this.y += this.vy;

        if (this.x - this.radius < 0 || this.x + this.radius > canvas.width) this.vx *= -1;
        if (this.y - this.radius < 0 || this.y + this.radius > canvas.height) this.vy *= -1;

        for (let other of bubbles) {
          if (other !== this) {
            const dx = other.x - this.x;
            const dy = other.y - this.y;
            const dist = Math.hypot(dx, dy);
            const minDist = this.radius + other.radius;
            if (dist < minDist) {
              const angle = Math.atan2(dy, dx);
              const move = (minDist - dist) / 2;
              this.x -= Math.cos(angle) * move;
              this.y -= Math.sin(angle) * move;
              other.x += Math.cos(angle) * move;
              other.y += Math.sin(angle) * move;
            }
          }
        }

        this.draw();
      }
    }

    const bubbles = [];

    async function fetchData() {
      const symbols = [
        'VALE3', 'PETR4', 'ITUB4', 'B3SA3', 'MGLU3', 'BBAS3', 'WEGE3', 'ABEV3',
        'EMBR3', 'RDOR3', 'RENT3', 'ASAI3', 'CSNA3', 'GGBR4', 'ARML3', 'OIBR3',
        'PDGR3', 'CEAB3', 'INTB3', 'LREN3', 'EQTL3', 'VIVT3', 'BEEF3', 'ALPA4'
      ];

      const url = `https://brapi.dev/api/quote/${symbols.join(",")}?token=5bTDfSmR2ieax6y7JUqDAD`;
      try {
        const res = await fetch(url);
        const data = await res.json();

        for (let item of data.results) {
          const change = item.changePercent ?? 0;
          const radius = Math.max(30, Math.abs(change) * 5 + 20);
          const color = change >= 0 ? "#00ff00" : "#ff0000";
          const x = Math.random() * (canvas.width - radius * 2) + radius;
          const y = Math.random() * (canvas.height - radius * 2) + radius;
          const vx = (Math.random() - 0.5) * 1.2;
          const vy = (Math.random() - 0.5) * 1.2;
          const label = `${item.symbol} ${change.toFixed(2)}%`;
          bubbles.push(new Bubble(x, y, radius, color, label, vx, vy));
        }

        animate();
      } catch (e) {
        console.error("Erro ao buscar dados da API:", e);
        ctx.fillStyle = "white";
        ctx.font = "30px Arial";
        ctx.textAlign = "center";
        ctx.fillText("API ERRO", canvas.width / 2, canvas.height / 2);
      }
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let bubble of bubbles) {
        bubble.update(bubbles);
      }
      requestAnimationFrame(animate);
    }

    fetchData();
  </script>
</body>
</html>