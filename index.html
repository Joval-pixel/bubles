<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Bubles — Ações ao Vivo</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #000;
      font-family: Arial, sans-serif;
    }

    h1 {
      color: white;
      text-align: center;
      margin: 20px 0;
    }

    .bubble {
      position: absolute;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-weight: bold;
      color: white;
      border: 3px solid white;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      transition: transform 0.3s;
      overflow: hidden;
      white-space: nowrap;
      flex-direction: column;
      cursor: pointer;
    }

    .bubble span {
      font-size: clamp(10px, 3vw, 18px);
      line-height: 1.1;
      padding: 4px;
    }

    .positive {
      background-color: #00cc00;
      box-shadow: 0 0 20px #00ff00, inset 0 0 10px #00ff00;
      filter: drop-shadow(0 0 5px #00ff00);
    }

    .negative {
      background-color: #cc0000;
      box-shadow: 0 0 20px #ff0000, inset 0 0 10px #ff0000;
      filter: drop-shadow(0 0 5px #ff0000);
    }
  </style>
</head>
<body>
  <h1>Bubles — Ações ao Vivo</h1>

  <script>
    const API_KEY = "5bTDfSmR2ieax6y7JUqDAD"; // sua chave Brapi
    const tickers = ["VALE3", "PETR4", "ITUB4", "BBDC4", "ABEV3", "MGLU3", "WEGE3", "RENT3", "JBSS3", "LREN3", "RADL3", "GGBR4", "SUZB3", "B3SA3", "BBAS3"];

    async function carregarAcoes() {
      try {
        const url = `https://brapi.dev/api/quote/${tickers.join(",")}?token=${API_KEY}`;
        const res = await fetch(url);
        const data = await res.json();
        exibirBolhas(data.stocks);
      } catch (e) {
        alert("Erro ao carregar dados da API.");
        console.error(e);
      }
    }

    function exibirBolhas(stocks) {
      const usadaCoords = [];

      stocks.forEach(stock => {
        const div = document.createElement("div");
        const variation = parseFloat(stock.change || 0);
        const name = stock.stock || "AÇÃO";
        const percent = variation.toFixed(2) + "%";

        const radius = 60 + Math.min(Math.abs(variation) * 10, 80); // tamanho proporcional à variação
        div.className = `bubble ${variation >= 0 ? "positive" : "negative"}`;
        div.style.width = div.style.height = radius + "px";

        // Evitar sobreposição grosseira
        let x, y, maxTries = 50, tries = 0;
        do {
          x = Math.random() * (window.innerWidth - radius);
          y = Math.random() * (window.innerHeight - radius - 60) + 60;
          tries++;
        } while (
          usadaCoords.some(coord =>
            Math.hypot(coord.x - x, coord.y - y) < radius * 1.2
          ) && tries < maxTries
        );
        usadaCoords.push({ x, y });

        div.style.left = x + "px";
        div.style.top = y + "px";
        div.innerHTML = `<span>${name}<br>${percent}</span>`;
        document.body.appendChild(div);
      });
    }

    carregarAcoes();
  </script>
</body>
</html>