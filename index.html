<script>
  const container = document.getElementById("container");

  async function fetchStocks() {
    try {
      const response = await fetch("https://brapi.dev/api/quote/list?token=5bTDfSmR2ieax6y7JUqDAD");
      const json = await response.json();
      const stocks = json.stocks.slice(0, 40); // acessa corretamente a chave "stocks"

      container.innerHTML = "";

      stocks.forEach(stock => {
        const variation = stock.change;
        const bubble = document.createElement("div");
        bubble.className = "bubble " + (variation >= 0 ? "positive" : "negative");

        const size = 60 + Math.min(Math.abs(variation) * 10, 120);
        bubble.style.width = `${size}px`;
        bubble.style.height = `${size}px`;

        const vw = window.innerWidth - size;
        const vh = window.innerHeight - size;
        bubble.style.left = `${Math.random() * vw}px`;
        bubble.style.top = `${Math.random() * vh}px`;

        bubble.innerHTML = `
          <span>${stock.stock}</span>
          <span>${variation.toFixed(2)}%</span>
        `;

        container.appendChild(bubble);
      });
    } catch (error) {
      console.error("Erro ao carregar dados:", error);
    }
  }

  fetchStocks();
  setInterval(fetchStocks, 60000);
</script>