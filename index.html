<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bubles — Ações ao Vivo</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #0f1115;
      font-family: 'Arial', sans-serif;
    }
    h1 {
      color: cyan;
      text-align: center;
      font-size: 24px;
      margin-top: 20px;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <h1>Bubles — Ações ao Vivo</h1>
  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    const tickers = [
      'VALE3', 'PETR4', 'ITUB4', 'BBAS3', 'PRIO3',
      'WEGE3', 'MGLU3', 'BBDC4', 'ELET3', 'LREN3',
      'ABEV3', 'B3SA3', 'RENT3', 'CSNA3', 'GGBR4',
      'RAIZ4', 'SUZB3', 'USIM5', 'BRKM5', 'HAPV3'
    ];

    const apiKey = '5bTDfSmR2ieax6y7JUqDAD';
    const url = `https://brapi.dev/api/quote/${tickers.join(',')}?token=${apiKey}`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        if (!data || !data.results) return;
        const bubbles = data.results.map(stock => {
          const change = stock.change_percent;
          const color = change > 0 ? '#00c853' : (change < 0 ? '#d50000' : '#9e9e9e');
          const borderColor = '#fff';
          const label = `${stock.stock}\n${change > 0 ? '+' : ''}${change.toFixed(2)}%`;
          const radius = Math.max(30, Math.min(100, Math.abs(change) * 10 + 30));
          return {
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            dx: (Math.random() - 0.5) * 1.5,
            dy: (Math.random() - 0.5) * 1.5,
            radius,
            color,
            borderColor,
            label
          };
        });

        function drawBubble(bubble) {
          ctx.beginPath();
          ctx.arc(bubble.x, bubble.y, bubble.radius, 0, Math.PI * 2);
          ctx.fillStyle = bubble.color;
          ctx.fill();
          ctx.lineWidth = 4;
          ctx.strokeStyle = bubble.borderColor;
          ctx.stroke();
          ctx.closePath();

          ctx.fillStyle = '#ffffff';
          ctx.font = `bold ${Math.max(12, bubble.radius / 4)}px Arial`;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';

          const lines = bubble.label.split('\n');
          lines.forEach((line, i) => {
            ctx.fillText(line, bubble.x, bubble.y + (i - 0.5) * (bubble.radius / 3));
          });
        }

        function animate() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          for (let i = 0; i < bubbles.length; i++) {
            const b = bubbles[i];

            b.x += b.dx;
            b.y += b.dy;

            if (b.x + b.radius > canvas.width || b.x - b.radius < 0) b.dx *= -1;
            if (b.y + b.radius > canvas.height || b.y - b.radius < 0) b.dy *= -1;

            // Simples detecção de colisão para evitar sobreposição
            for (let j = 0; j < bubbles.length; j++) {
              if (i !== j) {
                const b2 = bubbles[j];
                const dx = b.x - b2.x;
                const dy = b.y - b2.y;
                const dist = Math.hypot(dx, dy);
                if (dist < b.radius + b2.radius) {
                  const angle = Math.atan2(dy, dx);
                  const move = (b.radius + b2.radius - dist) / 2;
                  b.x += Math.cos(angle) * move;
                  b.y += Math.sin(angle) * move;
                  b2.x -= Math.cos(angle) * move;
                  b2.y -= Math.sin(angle) * move;
                }
              }
            }

            drawBubble(b);
          }

          requestAnimationFrame(animate);
        }

        animate();
      })
      .catch(error => {
        console.error('Erro ao buscar dados:', error);
      });
  </script>
</body>
</html>