<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bubles — A Bolsa que Respira</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      font-family: Arial, sans-serif;
      color: white;
      overflow: hidden;
    }
    #menu {
      display: flex;
      justify-content: center;
      gap: 30px;
      padding: 15px;
      background: #111;
    }
    #menu div {
      cursor: pointer;
      font-weight: bold;
    }
    .active {
      border-bottom: 3px solid limegreen;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <div id="menu">
    <div id="acoes" class="active">Ações</div>
    <div id="cripto">Criptomoedas</div>
    <div id="commodities">Commodities</div>
  </div>
  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const menuItems = document.querySelectorAll('#menu div');
    menuItems.forEach(item => {
      item.addEventListener('click', () => {
        menuItems.forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        if (item.id === 'acoes') loadData('stocks');
        if (item.id === 'cripto') loadData('crypto');
        if (item.id === 'commodities') loadData('commodities');
      });
    });

    async function loadData(type) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      try {
        const res = await fetch(`https://brapi.dev/api/${type}?token=5bTDfSmR2ieax6y7JUqDAD`);
        const json = await res.json();
        const list = json.stocks || json.coins || json.results || [];
        const bubbles = list.map((item, index) => ({
          symbol: item.stock || item.coin || item.name,
          change: parseFloat(item.change || 0),
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          radius: Math.min(Math.max(Math.abs(parseFloat(item.change)) * 8, 20), 80),
          dx: (Math.random() - 0.5) * 1.5,
          dy: (Math.random() - 0.5) * 1.5
        }));

        animate(bubbles);
      } catch (e) {
        console.error(e);
        drawError();
      }
    }

    function drawError() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'white';
      ctx.textAlign = 'center';
      ctx.font = '30px Arial';
      ctx.fillText('API ERRO', canvas.width / 2, canvas.height / 2);
    }

    function animate(bubbles) {
      function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let b of bubbles) {
          b.x += b.dx;
          b.y += b.dy;

          if (b.x < b.radius || b.x > canvas.width - b.radius) b.dx *= -1;
          if (b.y < b.radius || b.y > canvas.height - b.radius) b.dy *= -1;

          const grad = ctx.createRadialGradient(b.x, b.y, 0, b.x, b.y, b.radius);
          const color = b.change >= 0 ? 'lime' : 'red';
          grad.addColorStop(0, color);
          grad.addColorStop(1, 'black');

          ctx.beginPath();
          ctx.fillStyle = grad;
          ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
          ctx.fill();

          ctx.fillStyle = 'white';
          ctx.font = `${Math.max(12, b.radius / 4)}px Arial`;
          ctx.textAlign = 'center';
          ctx.fillText(b.symbol, b.x, b.y - 5);

          ctx.font = `${Math.max(10, b.radius / 5)}px Arial`;
          ctx.fillText(`${b.change.toFixed(2)}%`, b.x, b.y + 15);
        }
        requestAnimationFrame(loop);
      }
      loop();
    }

    loadData('stocks');
  </script>
</body>
</html>