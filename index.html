<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bubles – A Bolsa que Respira</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; font-family: Arial, sans-serif; }
    canvas { display: block; }
    #setores {
      position: fixed;
      top: 0;
      width: 100%;
      background: #111;
      color: white;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      z-index: 10;
    }
    .botao-setor {
      padding: 10px 15px;
      margin: 5px;
      background: #222;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 5px;
      font-size: 14px;
    }
    .botao-setor.active {
      background: #00ff00;
      color: black;
    }
  </style>
</head>
<body>
  <div id="setores">
    <button class="botao-setor active" data-setor="Todos">Todos</button>
    <button class="botao-setor" data-setor="Financeiro">Financeiro</button>
    <button class="botao-setor" data-setor="Energia">Energia</button>
    <button class="botao-setor" data-setor="Varejo">Varejo</button>
    <button class="botao-setor" data-setor="Tecnologia">Tecnologia</button>
    <button class="botao-setor" data-setor="Saúde">Saúde</button>
    <button class="botao-setor" data-setor="Indústria">Indústria</button>
  </div>
  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    class Bubble {
      constructor(x, y, radius, color, text, vx, vy, setor) {
        this.x = x;
        this.y = y;
        this.radius = radius;
        this.color = color;
        this.text = text;
        this.vx = vx;
        this.vy = vy;
        this.setor = setor;
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.shadowColor = this.color;
        ctx.shadowBlur = 15;
        ctx.fill();
        ctx.closePath();
        ctx.shadowBlur = 0;
        ctx.fillStyle = "white";
        ctx.font = `${Math.max(this.radius / 3, 10)}px Arial`;
        ctx.textAlign = "center";
        ctx.fillText(this.text, this.x, this.y + 4);
      }

      update(bubbles) {
        this.x += this.vx;
        this.y += this.vy;

        if (this.x - this.radius < 0 || this.x + this.radius > canvas.width) this.vx *= -1;
        if (this.y - this.radius < 0 || this.y + this.radius > canvas.height) this.vy *= -1;

        for (let other of bubbles) {
          if (other !== this) {
            const dx = other.x - this.x;
            const dy = other.y - this.y;
            const dist = Math.hypot(dx, dy);
            const minDist = this.radius + other.radius;
            if (dist < minDist) {
              const angle = Math.atan2(dy, dx);
              const move = (minDist - dist) / 2;
              this.x -= Math.cos(angle) * move;
              this.y -= Math.sin(angle) * move;
              other.x += Math.cos(angle) * move;
              other.y += Math.sin(angle) * move;
            }
          }
        }

        this.draw();
      }
    }

    const bubbles = [];
    let setorAtivo = "Todos";

    async function fetchData() {
      const ativos = [
        { symbol: "VALE3", setor: "Indústria" },
        { symbol: "PETR4", setor: "Energia" },
        { symbol: "ITUB4", setor: "Financeiro" },
        { symbol: "B3SA3", setor: "Financeiro" },
        { symbol: "MGLU3", setor: "Varejo" },
        { symbol: "BBAS3", setor: "Financeiro" },
        { symbol: "WEGE3", setor: "Indústria" },
        { symbol: "ABEV3", setor: "Consumo" },
        { symbol: "RDOR3", setor: "Saúde" },
        { symbol: "VIVT3", setor: "Tecnologia" }
      ];

      const url = "https://brapi.dev/api/quote/" + ativos.map(a => a.symbol).join(",") + "?token=5bTDfSmR2ieax6y7JUqDAD";
      const res = await fetch(url);
      const data = await res.json();

      for (let item of data.results) {
        const change = item.changePercent ?? 0;
        const radius = Math.max(30, Math.abs(change) * 5 + 20);
        const color = change >= 0 ? "#00ff00" : "#ff0000";
        const x = Math.random() * (canvas.width - radius * 2) + radius;
        const y = Math.random() * (canvas.height - radius * 2) + radius;
        const vx = (Math.random() - 0.5) * 1.2;
        const vy = (Math.random() - 0.5) * 1.2;
        const label = `${item.symbol} ${change.toFixed(2)}%`;
        const setor = ativos.find(a => a.symbol === item.symbol)?.setor || "Outros";
        bubbles.push(new Bubble(x, y, radius, color, label, vx, vy, setor));
      }

      animate();
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let bubble of bubbles) {
        if (setorAtivo === "Todos" || bubble.setor === setorAtivo) {
          bubble.update(bubbles.filter(b => setorAtivo === "Todos" || b.setor === setorAtivo));
        }
      }
      requestAnimationFrame(animate);
    }

    document.querySelectorAll(".botao-setor").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".botao-setor").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        setorAtivo = btn.dataset.setor;
      });
    });

    fetchData();
  </script>
</body>
</html>