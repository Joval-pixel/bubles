<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Bubles - A Bolsa que Respira</title>
    <style>
        body {
            margin: 0;
            background-color: #000;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #menu {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 15px;
            background-color: #111;
        }
        #menu div {
            color: white;
            cursor: pointer;
            font-size: 18px;
            padding-bottom: 5px;
        }
        #menu .active {
            color: #00ff00;
            border-bottom: 3px solid #00ff00;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="menu">
        <div id="acoes" class="active">Ações</div>
        <div id="criptos">Criptomoedas</div>
        <div id="commodities">Commodities</div>
    </div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let bubbles = [];
        const token = "5bTDfSmR2ieax6y7JUqDAD";
        let currentType = "stocks";

        async function fetchData(type) {
            try {
                const res = await fetch(`https://brapi.dev/api/${type}?token=${token}`);
                const data = await res.json();
                return data.stocks || data.coins || data.commodities || [];
            } catch (e) {
                return [{ stock: "API ERRO", change: 0, close: 0 }];
            }
        }

        function createBubbles(data) {
            bubbles = data.map((item, i) => {
                const pct = item.change || 0;
                const color = pct >= 0 ? "rgba(0,255,0,0.8)" : "rgba(255,0,0,0.8)";
                const radius = Math.min(150, 30 + Math.abs(pct) * 10);
                return {
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    dx: Math.random() * 2 - 1,
                    dy: Math.random() * 2 - 1,
                    radius,
                    label: item.stock || item.name,
                    pct: parseFloat(pct).toFixed(2),
                    color
                };
            });
        }

        function drawBubbles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            bubbles.forEach(b => {
                ctx.beginPath();
                ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
                ctx.fillStyle = b.color;
                ctx.shadowColor = "#fff";
                ctx.shadowBlur = 10;
                ctx.fill();
                ctx.closePath();
                ctx.font = `${Math.min(20, b.radius / 3)}px Arial`;
                ctx.fillStyle = "#fff";
                ctx.textAlign = "center";
                ctx.fillText(`${b.label}`, b.x, b.y);
                ctx.fillText(`${b.pct}%`, b.x, b.y + 15);
            });
        }

        function update() {
            bubbles.forEach(b => {
                b.x += b.dx;
                b.y += b.dy;
                if (b.x < b.radius || b.x > canvas.width - b.radius) b.dx *= -1;
                if (b.y < b.radius || b.y > canvas.height - b.radius) b.dy *= -1;
            });
            drawBubbles();
            requestAnimationFrame(update);
        }

        async function load(type) {
            const data = await fetchData(type);
            createBubbles(data);
        }

        document.getElementById("acoes").onclick = () => {
            currentType = "stocks";
            setActive("acoes");
            load("stocks");
        };
        document.getElementById("criptos").onclick = () => {
            currentType = "crypto";
            setActive("criptos");
            load("crypto");
        };
        document.getElementById("commodities").onclick = () => {
            currentType = "commodities";
            setActive("commodities");
            load("commodities");
        };

        function setActive(id) {
            document.querySelectorAll("#menu div").forEach(el => el.classList.remove("active"));
            document.getElementById(id).classList.add("active");
        }

        load(currentType);
        update();
    </script>
</body>
</html>