<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bubles — Ações ao Vivo</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      overflow: hidden;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    h1 {
      color: cyan;
      font-size: 1.2rem;
      margin: 20px 0;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body onload="fetchData()">
  <h1>Bubles — Ações ao Vivo</h1>
  <canvas id="bubbleCanvas"></canvas>

  <script>
    const canvas = document.getElementById("bubbleCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    async function fetchData() {
      try {
        const tickers = ["VALE3", "B3SA3", "PETR4", "ITUB4", "WEGE3", "ABEV3"];
        const response = await fetch(`https://brapi.dev/api/quote/${tickers.join(",")}?token=5bTDfSmR2ieax6y7JUqDAD`);
        const data = await response.json();
        console.log("✅ Dados recebidos da Brapi:", data); // ← VERIFICAÇÃO NO CONSOLE
        if (!data.results || data.results.length === 0) {
          console.warn("⚠️ Nenhum dado recebido da API.");
          return;
        }
        renderBubbles(data.results);
      } catch (error) {
        console.error("Erro ao buscar dados da API:", error);
      }
    }

    function renderBubbles(stocks) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const maxRadius = 100;
      const minRadius = 30;
      const spacing = 150;

      stocks.forEach((stock, index) => {
        const percent = stock.regularMarketChangePercent;
        const radius = Math.max(minRadius, Math.min(maxRadius, Math.abs(percent) * 10));
        const x = (index + 1) * spacing;
        const y = canvas.height / 2;
        const color = percent >= 0 ? "green" : "red";

        ctx.beginPath();
        ctx.arc(x, y, radius, 0, 2 * Math.PI);
        ctx.fillStyle = color;
        ctx.fill();

        ctx.fillStyle = "white";
        ctx.font = "bold 14px Arial";
        ctx.textAlign = "center";
        ctx.fillText(stock.symbol, x, y - 5);
        ctx.fillText(`${percent.toFixed(2)}%`, x, y + 15);
      });
    }
  </script>
</body>
</html>