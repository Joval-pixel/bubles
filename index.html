<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bubles — Ações ao Vivo</title>
  <style>
    body {
      margin: 0;
      background-color: #0f1115;
      font-family: 'Arial', sans-serif;
      overflow: hidden;
    }

    h1 {
      color: #00f6ff;
      text-align: center;
      margin-top: 20px;
      font-size: 26px;
    }

    .bubble {
      position: absolute;
      border-radius: 50%;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      border: 2px solid #ffffffbb;
      box-shadow: 0 0 10px #00000066;
      text-align: center;
      transition: transform 0.2s;
      padding: 5px;
      max-width: 150px;
      max-height: 150px;
    }

    .bubble:hover {
      transform: scale(1.1);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Bubles — Ações ao Vivo</h1>

  <script>
    const apiKey = '5bTDfSmR2ieax6y7JUqDAD';
    const symbols = [
      "VALE3", "PETR4", "ITUB4", "BBDC4", "BBAS3", "PRIO3", "MGLU3", "RENT3", "WEGE3", "SUZB3",
      "ABEV3", "EGIE3", "RAIZ4", "LREN3", "B3SA3", "JBSS3", "CPLE6", "HAPV3", "GGBR4", "ENEV3",
      "VBBR3", "KLBN11", "ALPA4", "CCRO3", "EMBR3", "EQTL3", "CSAN3", "CYRE3", "MRVE3", "CMIG4",
      "CVCB3", "PETZ3", "USIM5", "BRFS3", "AZUL4", "GOLL4", "TOTS3", "YDUQ3", "TIMS3", "QUAL3",
      "NEOE3", "SMTO3", "SANB11", "TRPL4", "BRKM5", "ARZZ3", "ENBR3", "RADL3", "CRFB3", "LWSA3"
    ];

    const width = window.innerWidth;
    const height = window.innerHeight;

    async function fetchData() {
      const chunks = [];
      const chunkSize = 10;
      for (let i = 0; i < symbols.length; i += chunkSize) {
        const slice = symbols.slice(i, i + chunkSize);
        const url = `https://brapi.dev/api/quote/${slice.join(',')}?token=${apiKey}`;
        const res = await fetch(url);
        const json = await res.json();
        chunks.push(...json.results);
        await new Promise(resolve => setTimeout(resolve, 300)); // respeita limite
      }
      return chunks.filter(asset => asset && typeof asset.change_percent === 'number');
    }

    function createBubble(asset) {
      const div = document.createElement('div');
      const pct = asset.change_percent;
      const absPct = Math.abs(pct);
      const radius = Math.min(30 + absPct * 5, 75);
      div.className = 'bubble';
      div.style.width = `${radius * 2}px`;
      div.style.height = `${radius * 2}px`;
      div.style.left = `${Math.random() * (width - radius * 2)}px`;
      div.style.top = `${Math.random() * (height - radius * 2)}px`;

      let color;
      if (pct > 0) {
        color = '#00d26a'; // verde
      } else if (pct < 0) {
        color = '#ff4c4c'; // vermelho
      } else {
        color = '#888'; // neutro
      }

      div.style.backgroundColor = color;
      div.innerHTML = `
        <div style="font-size: 16px;">${asset.symbol}</div>
        <div style="font-size: 14px;">${pct > 0 ? '+' : ''}${pct.toFixed(2)}%</div>
      `;
      return div;
    }

    async function init() {
      const data = await fetchData();
      data.forEach(asset => {
        const bubble = createBubble(asset);
        document.body.appendChild(bubble);
      });
    }

    init();
  </script>
</body>
</html>