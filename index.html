<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUBLES - A√ß√µes ao Vivo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #0a0a0a;
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
            background: radial-gradient(ellipse at center, #111111 0%, #0a0a0a 100%);
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo h1 {
            font-size: 24px;
            color: #22c55e;
            margin: 0;
            font-weight: bold;
        }

        .subtitle {
            font-size: 12px;
            color: #888;
            margin-left: 10px;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-input {
            padding: 8px 12px;
            border: 1px solid #333;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            outline: none;
            width: 200px;
        }

        .search-input::placeholder {
            color: #888;
        }

        .time-controls {
            display: flex;
            gap: 10px;
        }

        .time-btn {
            padding: 8px 16px;
            border: 1px solid #333;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .time-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .time-btn.active {
            background: #22c55e;
            color: #0a0a0a;
            border-color: #22c55e;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
        }

        .bubble-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .bubble {
            position: absolute;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            border: none;
        }

        .bubble:hover {
            transform: scale(1.05);
            z-index: 100;
        }

        /* Cores id√™nticas ao CryptoBubbles */
        .bubble.positive {
            background: radial-gradient(circle at 30% 30%, #22c55e 0%, #16a34a 70%, #15803d 100%);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4), 0 0 40px rgba(34, 197, 94, 0.2);
        }

        .bubble.negative {
            background: radial-gradient(circle at 30% 30%, #ef4444 0%, #dc2626 70%, #b91c1c 100%);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4), 0 0 40px rgba(239, 68, 68, 0.2);
        }

        .bubble.neutral {
            background: radial-gradient(circle at 30% 30%, #6b7280 0%, #4b5563 70%, #374151 100%);
            box-shadow: 0 0 15px rgba(107, 114, 128, 0.3);
        }

        .bubble-symbol {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 2px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .bubble-change {
            font-size: 12px;
            margin-bottom: 2px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .bubble-price {
            font-size: 10px;
            opacity: 0.9;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #22c55e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #ef4444;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            text-align: center;
            font-size: 12px;
            color: #888;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid #333;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: #22c55e;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: white;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }

            .controls {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }

            .search-input {
                width: 100%;
            }

            .time-controls {
                justify-content: center;
            }

            .footer-info {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <h1>ü´ß BUBLES</h1>
                <span class="subtitle">A√ß√µes B3 ao Vivo</span>
            </div>
            <div class="controls">
                <input type="text" id="searchInput" placeholder="Buscar a√ß√£o..." class="search-input">
                <div class="time-controls">
                    <button class="time-btn active" data-filter="day">Dia</button>
                    <button class="time-btn" data-filter="week">Semana</button>
                    <button class="time-btn" data-filter="month">M√™s</button>
                </div>
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span class="status-text">Conectando...</span>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div id="bubbleContainer" class="bubble-container">
                <!-- Bolhas ser√£o inseridas aqui dinamicamente -->
            </div>
            
            <div id="loadingIndicator" class="loading-indicator">
                <div class="loading-spinner"></div>
                <p>Carregando dados das a√ß√µes...</p>
            </div>

            <div id="errorMessage" class="error-message" style="display: none;">
                <p>‚ö†Ô∏è Erro ao carregar dados. Usando dados simulados.</p>
            </div>
        </main>

        <footer class="footer">
            <div class="footer-info">
                <span>Dados fornecidos pela API Brapi ‚Ä¢ Atualiza√ß√£o a cada 10 segundos</span>
                <span class="last-update">√öltima atualiza√ß√£o: --:--</span>
            </div>
        </footer>
    </div>

    <!-- Modal de Informa√ß√µes da A√ß√£o -->
    <div id="tradingViewModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Informa√ß√µes da A√ß√£o</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="tradingViewWidget"></div>
            </div>
        </div>
        <div class="modal-overlay"></div>
    </div>

    <script>
        // Configura√ß√µes globais com TOKEN da Brapi
        const CONFIG = {
            API_URL: 'https://brapi.dev/api/quote/list',
            API_TOKEN: '5bTDfSmR2ieax6y7JUqDAD',
            UPDATE_INTERVAL: 10000,
            MIN_BUBBLES: 50,
            BUBBLE_MIN_SIZE: 40,
            BUBBLE_MAX_SIZE: 120,
            ANIMATION_SPEED: 0.8,
            API_TIMEOUT: 15000,
            COLLISION_FORCE: 0.05,
            FRICTION: 0.98
        };

        // Estado global
        let bubbles = [];
        let animationId;
        let isLoading = true;
        let lastUpdate = null;
        let useSimulatedData = false;
        let currentFilter = 'day';

        // Dados simulados como fallback
        const FALLBACK_DATA = [
            { stock: 'PETR4', name: 'PETROBRAS', close: 32.45, change: 2.34, volume: 45678900 },
            { stock: 'VALE3', name: 'VALE', close: 65.78, change: -1.23, volume: 38456789 },
            { stock: 'ITUB4', name: 'ITAU UNIBANCO', close: 28.90, change: 0.87, volume: 34567890 },
            { stock: 'BBDC4', name: 'BRADESCO', close: 15.67, change: -0.45, volume: 29876543 },
            { stock: 'ABEV3', name: 'AMBEV', close: 12.34, change: 1.56, volume: 25678901 },
            { stock: 'WEGE3', name: 'WEG', close: 45.23, change: 3.21, volume: 23456789 },
            { stock: 'MGLU3', name: 'MAGAZINE LUIZA', close: 8.76, change: -2.34, volume: 21345678 },
            { stock: 'JBSS3', name: 'JBS', close: 34.56, change: 0.98, volume: 19234567 },
            { stock: 'RENT3', name: 'LOCALIZA', close: 67.89, change: -1.87, volume: 18123456 },
            { stock: 'LREN3', name: 'LOJAS RENNER', close: 23.45, change: 2.76, volume: 17012345 }
        ];

        // Classe Bubble com cores do CryptoBubbles
        class Bubble {
            constructor(data, container) {
                // Adaptar para estrutura da API Brapi
                this.symbol = data.stock || data.symbol;
                this.name = data.name || data.shortName || this.symbol;
                this.price = data.close || data.regularMarketPrice || 0;
                this.change = data.change || data.regularMarketChangePercent || 0;
                this.volume = data.volume || data.regularMarketVolume || 0;
                
                this.container = container;
                this.element = null;
                
                this.size = this.calculateSize();
                this.x = Math.random() * Math.max(0, container.clientWidth - this.size);
                this.y = Math.random() * Math.max(0, container.clientHeight - this.size);
                this.vx = (Math.random() - 0.5) * CONFIG.ANIMATION_SPEED;
                this.vy = (Math.random() - 0.5) * CONFIG.ANIMATION_SPEED;
                
                this.createElement();
                this.updateContent();
            }
            
            calculateSize() {
                const minVolume = 100000;
                const maxVolume = 50000000;
                const normalizedVolume = Math.log(Math.max(this.volume, minVolume)) / Math.log(maxVolume);
                const minSize = CONFIG.BUBBLE_MIN_SIZE;
                const maxSize = CONFIG.BUBBLE_MAX_SIZE;
                return minSize + (maxSize - minSize) * Math.min(normalizedVolume, 1);
            }
            
            createElement() {
                this.element = document.createElement('div');
                this.element.className = 'bubble';
                this.element.style.width = `${this.size}px`;
                this.element.style.height = `${this.size}px`;
                this.element.style.left = `${this.x}px`;
                this.element.style.top = `${this.y}px`;
                
                this.element.addEventListener('click', () => {
                    openStockModal(this.symbol, this.name, this.price, this.change);
                });
                
                this.container.appendChild(this.element);
            }
            
            updateContent() {
                // Cores id√™nticas ao CryptoBubbles
                const colorClass = this.change > 0 ? 'positive' : this.change < 0 ? 'negative' : 'neutral';
                this.element.className = `bubble ${colorClass}`;
                
                const changeSign = this.change > 0 ? '+' : '';
                const fontSize = Math.max(10, this.size / 8);
                
                this.element.innerHTML = `
                    <div class="bubble-symbol" style="font-size: ${fontSize}px">${this.symbol}</div>
                    <div class="bubble-change" style="font-size: ${fontSize * 0.8}px">${changeSign}${this.change.toFixed(2)}%</div>
                    <div class="bubble-price" style="font-size: ${fontSize * 0.7}px">R$ ${this.price.toFixed(2)}</div>
                `;
            }
            
            update() {
                this.vx += (Math.random() - 0.5) * CONFIG.COLLISION_FORCE;
                this.vy += (Math.random() - 0.5) * CONFIG.COLLISION_FORCE;
                
                this.vx *= CONFIG.FRICTION;
                this.vy *= CONFIG.FRICTION;
                this.vx = Math.max(-0.1, Math.min(0.1, this.vx));
                this.vy = Math.max(-0.1, Math.min(0.1, this.vy));
                
                this.x += this.vx;
                this.y += this.vy;
                
                const maxX = Math.max(0, this.container.clientWidth - this.size);
                const maxY = Math.max(0, this.container.clientHeight - this.size);
                
                if (this.x <= 0 || this.x >= maxX) {
                    this.vx *= -0.8;
                    this.x = Math.max(0, Math.min(maxX, this.x));
                }
                
                if (this.y <= 0 || this.y >= maxY) {
                    this.vy *= -0.8;
                    this.y = Math.max(0, Math.min(maxY, this.y));
                }
                
                this.element.style.left = `${this.x}px`;
                this.element.style.top = `${this.y}px`;
            }
            
            checkCollision(other) {
                const dx = this.x + this.size/2 - (other.x + other.size/2);
                const dy = this.y + this.size/2 - (other.y + other.size/2);
                const distance = Math.sqrt(dx * dx + dy * dy);
                const minDistance = (this.size + other.size) / 2;
                
                if (distance < minDistance && distance > 0) {
                    const overlap = minDistance - distance;
                    const separationX = (dx / distance) * overlap * 0.5;
                    const separationY = (dy / distance) * overlap * 0.5;
                    
                    this.x += separationX;
                    this.y += separationY;
                    other.x -= separationX;
                    other.y -= separationY;
                    
                    const tempVx = this.vx;
                    const tempVy = this.vy;
                    this.vx = other.vx * 0.8;
                    this.vy = other.vy * 0.8;
                    other.vx = tempVx * 0.8;
                    other.vy = tempVy * 0.8;
                }
            }
            
            destroy() {
                if (this.element && this.element.parentNode) {
                    this.element.parentNode.removeChild(this.element);
                }
            }
        }

        // Fun√ß√£o para buscar dados da API com TOKEN
        async function fetchStockData() {
            try {
                console.log('üîÑ Buscando dados da API Brapi com token...');
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), CONFIG.API_TIMEOUT);
                
                const url = `${CONFIG.API_URL}?token=${CONFIG.API_TOKEN}&sortBy=volume&sortOrder=desc&limit=100`;
                
                const response = await fetch(url, {
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data && data.stocks && Array.isArray(data.stocks) && data.stocks.length > 0) {
                    useSimulatedData = false;
                    console.log(`‚úÖ ${data.stocks.length} a√ß√µes REAIS carregadas da Brapi!`);
                    
                    const errorElement = document.getElementById('errorMessage');
                    if (errorElement) {
                        errorElement.style.display = 'none';
                    }
                    
                    return data.stocks;
                } else {
                    throw new Error('Estrutura de dados da API n√£o reconhecida');
                }
            } catch (error) {
                console.error('‚ùå Erro ao buscar dados da API:', error);
                useSimulatedData = true;
                showErrorMessage();
                return generateFallbackData();
            }
        }

        function generateFallbackData() {
            console.log('‚ö†Ô∏è Usando dados simulados como fallback...');
            return FALLBACK_DATA.map(stock => ({
                ...stock,
                change: (Math.random() - 0.5) * 14
            }));
        }

        function showErrorMessage() {
            const errorElement = document.getElementById('errorMessage');
            if (errorElement) {
                errorElement.style.display = 'block';
                setTimeout(() => {
                    errorElement.style.display = 'none';
                }, 5000);
            }
        }

        function createBubbles(stockData) {
            console.log(`ü´ß Criando bolhas com ${stockData.length} a√ß√µes`);
            const container = document.getElementById('bubbleContainer');
            
            if (!container) {
                console.error('‚ùå Container de bolhas n√£o encontrado!');
                return;
            }
            
            bubbles.forEach(bubble => bubble.destroy());
            bubbles = [];
            
            const dataToUse = stockData.slice(0, Math.max(CONFIG.MIN_BUBBLES, stockData.length));
            
            dataToUse.forEach((stock, index) => {
                try {
                    const bubble = new Bubble(stock, container);
                    bubbles.push(bubble);
                } catch (error) {
                    console.error(`‚ùå Erro ao criar bolha ${index}:`, error);
                }
            });
            
            console.log(`‚úÖ ${bubbles.length} bolhas criadas com sucesso`);
            hideLoading();
        }

        function updateBubbles() {
            bubbles.forEach((bubble, index) => {
                try {
                    bubble.update();
                    
                    for (let i = index + 1; i < bubbles.length; i++) {
                        bubble.checkCollision(bubbles[i]);
                    }
                } catch (error) {
                    console.error(`‚ùå Erro ao atualizar bolha ${index}:`, error);
                }
            });
        }

        function animate() {
            try {
                updateBubbles();
                animationId = requestAnimationFrame(animate);
            } catch (error) {
                console.error('‚ùå Erro na anima√ß√£o:', error);
                setTimeout(() => {
                    animationId = requestAnimationFrame(animate);
                }, 1000);
            }
        }

        function hideLoading() {
            const loadingElement = document.getElementById('loadingIndicator');
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            isLoading = false;
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const lastUpdateElement = document.querySelector('.last-update');
            if (lastUpdateElement) {
                lastUpdateElement.textContent = `√öltima atualiza√ß√£o: ${timeString}`;
            }
            lastUpdate = now;
        }

        function updateStatusIndicator() {
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.status-text');
            
            if (statusDot && statusText) {
                if (useSimulatedData) {
                    statusDot.style.background = '#ef4444';
                    statusText.textContent = 'Dados simulados';
                } else {
                    statusDot.style.background = '#22c55e';
                    statusText.textContent = 'Dados reais Brapi';
                }
            }
        }

        function openStockModal(symbol, name, currentPrice, changePercent) {
            console.log(`üìä Abrindo modal para ${symbol}`);
            
            const modal = document.getElementById('tradingViewModal');
            const modalTitle = document.getElementById('modalTitle');
            const widgetContainer = document.getElementById('tradingViewWidget');
            
            if (!modal || !modalTitle || !widgetContainer) {
                console.error('‚ùå Elementos do modal n√£o encontrados');
                return;
            }
            
            modalTitle.textContent = `${symbol} - ${name}`;
            modal.style.display = 'flex';
            
            const periodText = currentFilter === 'day' ? 'Hoje' : 
                             currentFilter === 'week' ? 'Esta semana' : 'Este m√™s';
            
            widgetContainer.innerHTML = `
                <div style="color: white; text-align: center; padding: 40px; font-family: Arial, sans-serif;">
                    <div style="margin-bottom: 30px;">
                        <h2 style="color: #22c55e; margin: 0 0 10px 0; font-size: 28px;">${symbol}</h2>
                        <h3 style="color: #ccc; margin: 0 0 20px 0; font-size: 18px; font-weight: normal;">${name}</h3>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 30px; flex-wrap: wrap;">
                        <div style="text-align: center;">
                            <div style="color: #888; font-size: 14px; margin-bottom: 5px;">Pre√ßo Atual</div>
                            <div style="color: #22c55e; font-size: 24px; font-weight: bold;">R$ ${currentPrice.toFixed(2)}</div>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="color: #888; font-size: 14px; margin-bottom: 5px;">Varia√ß√£o ${periodText}</div>
                            <div style="color: ${changePercent >= 0 ? '#22c55e' : '#ef4444'}; font-size: 24px; font-weight: bold;">
                                ${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 20px; margin: 20px 0;">
                        <h4 style="color: #22c55e; margin: 0 0 15px 0;">Informa√ß√µes da A√ß√£o</h4>
                        <div style="text-align: left; max-width: 400px; margin: 0 auto;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #888;">S√≠mbolo:</span>
                                <span style="color: white;">${symbol}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #888;">Empresa:</span>
                                <span style="color: white;">${name}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #888;">Per√≠odo:</span>
                                <span style="color: white;">${periodText}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #888;">Fonte:</span>
                                <span style="color: ${useSimulatedData ? '#ef4444' : '#22c55e'};">
                                    ${useSimulatedData ? 'Dados Simulados' : 'API Brapi (Dados Reais)'}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <p style="color: #888; font-size: 14px; margin: 0; line-height: 1.4;">
                            üí° <strong>Dica:</strong> Use os bot√µes "Dia", "Semana" e "M√™s" no topo da p√°gina para alterar o per√≠odo de an√°lise.
                            ${useSimulatedData ? ' Dados simulados est√£o sendo exibidos devido √† indisponibilidade da API.' : ' Dados fornecidos em tempo real pela API Brapi.'}
                        </p>
                    </div>
                </div>
            `;
        }

        function closeModal() {
            const modal = document.getElementById('tradingViewModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function setTimeFilter(filter) {
            console.log(`‚è∞ Definindo filtro de tempo: ${filter}`);
            
            currentFilter = filter;
            
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`[data-filter="${filter}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                console.log(`‚úÖ Bot√£o ${filter} ativado com sucesso`);
            }
        }

        async function initializeApp() {
            console.log('üöÄ Inicializando aplica√ß√£o BUBLES...');
            
            try {
                const stockData = await fetchStockData();
                createBubbles(stockData);
                animate();
                updateLastUpdateTime();
                updateStatusIndicator();
                
                setInterval(async () => {
                    if (!isLoading) {
                        console.log('üîÑ Atualizando dados automaticamente...');
                        const newData = await fetchStockData();
                        createBubbles(newData);
                        updateLastUpdateTime();
                        updateStatusIndicator();
                    }
                }, CONFIG.UPDATE_INTERVAL);
                
                console.log('‚úÖ Aplica√ß√£o inicializada com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro na inicializa√ß√£o:', error);
                hideLoading();
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM carregado, inicializando...');
            
            // Configurar bot√µes de tempo
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const filter = e.target.getAttribute('data-filter');
                    if (filter) {
                        setTimeFilter(filter);
                    }
                });
            });
            
            // Configurar busca
            const searchInput = document.querySelector('.search-input');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    
                    bubbles.forEach(bubble => {
                        const isVisible = bubble.symbol.toLowerCase().includes(searchTerm) || 
                                        bubble.name.toLowerCase().includes(searchTerm);
                        bubble.element.style.display = isVisible ? 'flex' : 'none';
                    });
                });
            }
            
            // Configurar fechamento do modal
            const modal = document.getElementById('tradingViewModal');
            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
            }
            
            const closeBtn = document.querySelector('.modal-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', closeModal);
            }
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
            
            // Inicializar aplica√ß√£o
            initializeApp();
        });
    </script>
</body>
</html>